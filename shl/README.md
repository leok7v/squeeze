# Squeeze Single Header Library

Generated by scripts/amalgamate.bat or amalgamate.sh from squeeze.h and squeeze.c

Usage pattern for single header library:

```
// test.c file:
#include <stdio.h>
#include "shl/squeeze/squeeze.h" // assuming -I path is present

int main(int argc, const char* argv[]) {
    // trivial test of squeeze functions
    return 0;
}

#define squeeze_implementation
#include "shl/squeeze/squeeze.h" // This will include the implementation section.
```

Example code:

```
// t.c file
#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <errno.h>

#include "shl/squeeze/squeeze.h"

int main() {
    const char* lorem_ipsum = "Lorem ipsum dolor sit amet, "
                              "consectetur adipiscing elit, "
                              "sed do eiusmod tempor incididunt "
                              "ut labore et dolore magna aliqua.";
    // Buffers for compressed and decompressed data
    static uint8_t compressed_data[16 * 1024]; // 16KB buffer for compressed data
    static char decompressed_data[1024];       // Buffer for decompressed data
    {
        struct bitstream bs = {0};
        bs.data = compressed_data;
        bs.capacity = sizeof(compressed_data);
        struct squeeze s;
        squeeze_init(&s);
        const uint8_t* input_data = (const uint8_t*)lorem_ipsum;
        size_t input_size = strlen(lorem_ipsum);
        enum { bits_win = 11 }; // 2KB window
        squeeze_write_header(&bs, input_size);
        squeeze_compress(&s, &bs, input_data, input_size, 1u << bits_win);
        if (s.error != 0) {
            printf("Compression error: %d\n", s.error);
            return 1;
        }
        printf("Original size: %zu bytes\n", input_size);
        printf("Compressed size: %llu bytes\n", (unsigned long long)bs.bytes);
    }
    {
        struct bitstream bs_read = {0};
        bs_read.data = compressed_data;
        bs_read.bytes = bs.bytes; // Number of bytes written during compression
        struct squeeze s_read;
        squeeze_init(&s_read);
        uint64_t decompressed_size = 0;
        // Read header
        squeeze_read_header(&bs_read, &decompressed_size);
        if (decompressed_size != strlen(lorem_ipsum)) {
            printf("Decompressed size does not match original size\n");
            return 1;
        }
        squeeze_decompress(&s_read, &bs_read, (uint8_t*)decompressed_data, 
                                                        decompressed_size);
        // Check for errors
        if (s_read.error != 0) {
            printf("Decompression error: %d\n", s_read.error);
            return 1;
        }
        // Verify that decompressed data matches original data
        if (memcmp(decompressed_data, lorem_ipsum, decompressed_size) != 0) {
            printf("Decompressed data does not match original data\n");
            return 1;
        }
        printf("Decompression successful.\n");
    }
    return 0;
}

#define squeeze_implementation
#include "shl/squeeze/squeeze.h"

```